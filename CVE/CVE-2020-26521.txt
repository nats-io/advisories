Subject: Nil dereference in NATS JWT, DoS of nats-server

CVE: CVE-2020-26521

Background:

NATS.io is a high performance open source pub-sub distributed communication
technology, built for the cloud, on-premise, IoT, and edge computing.
The server is written in Go and there are client libraries in many languages
and frameworks.

The nats-io JWT library provides the handling for JWTs common to the NATS.io
projects.


Problem Description:

The NATS account system has an Operator trusted by the servers, which
signs Accounts, and each Account can then create and sign Users within
their account.  The Operator should be able to safely issue Accounts to
other entities which it does not fully trust.

A malicious Account could create and sign a User JWT with a state not
created by the normal tooling, such that decoding by the NATS JWT
library (written in Go) would attempt a nil dereference, aborting
execution.

The NATS Server is known to be impacted by this.


Affected versions:

JWT library:
 * all versions prior to 1.1.0

NATS Server:
 * Version 2 prior to 2.1.9


Impact:

JWT library:
 * Programs would nil dereference and panic, aborting execution by default.

NATS server:
 * Denial of Service caused by process termination


Workaround:

If your NATS servers do not trust any accounts which are managed by
untrusted entities, then malformed User credentials are unlikely to be
encountered.


Solution:

Upgrade the JWT dependency in any application using it.

Upgrade the NATS server if using NATS Accounts.

