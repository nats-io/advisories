Subject: Incorrect handling of credential expiry by NATS Server

CVE: CVE-2020-26892

Background:

NATS.io is a high performance open source pub-sub distributed communication
technology, built for the cloud, on-premise, IoT, and edge computing.
The server is written in Go and there are client libraries in many languages
and frameworks.

The nats-io JWT library provides the handling for JWTs common to the NATS.io
projects.


Problem Description:

NATS nats-server through 2020-10-07 has Incorrect Access Control because of how
expired credentials are handled.

The NATS accounts system has expiration timestamps on credentials; the
<https://github.com/nats-io/jwt> library had an API which encouraged misuse and
an IsRevoked() method which misused its own API.

A new IsClaimRevoked() method has correct handling and the nats-server has been
updated to use this.  The old IsRevoked() method now always returns true and
other client code will have to be updated to avoid calling it.

The CVE identifier should cover any application using the old JWT API, where
the nats-server is one of those applications.


Affected versions:

JWT library:
 * all versions prior to 1.1.0
 * fixed after nats-io/jwt PR 103 landed (2020-10-06)

NATS Server:
 * Version 2 prior to 2.1.9
   + 2.0.0 through and including 2.1.8 are vulnerable.
 * fixed with nats-io/nats-server PRs 1632, 1635, 1645


Impact:

Time-based credential expiry did not work.


Workaround:

Have credentials which only expire after fixes can be deployed.


Solution:

Upgrade the JWT dependency in any application using it.

Upgrade the NATS server if using NATS Accounts.


References:

* GitHub Security Advisory for JWT:
  <https://github.com/nats-io/jwt/security/advisories/GHSA-4w5x-x539-ppf5>
* GitHub Security Advisory for nats-server:
  <https://github.com/nats-io/nats-server/security/advisories/GHSA-2c64-vj8g-vwrq>
